<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Git权威指南 | Crayonの博客</title><meta name="author" content="魚禾"><meta name="copyright" content="魚禾"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="article">
<meta property="og:title" content="Git权威指南">
<meta property="og:url" content="http://sucrayon.top/posts/ca74b95d/index.html">
<meta property="og:site_name" content="Crayonの博客">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://sucrayon.top/images/cover/default-cover/5.jpg">
<meta property="article:published_time" content="2022-05-15T16:00:00.000Z">
<meta property="article:modified_time" content="2022-06-14T16:00:00.000Z">
<meta property="article:author" content="魚禾">
<meta property="article:tag" content="Git">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://sucrayon.top/images/cover/default-cover/5.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Git权威指南",
  "url": "http://sucrayon.top/posts/ca74b95d/",
  "image": "http://sucrayon.top/images/cover/default-cover/5.jpg",
  "datePublished": "2022-05-15T16:00:00.000Z",
  "dateModified": "2022-06-14T16:00:00.000Z",
  "author": [
    {
      "@type": "Person",
      "name": "魚禾",
      "url": "http://sucrayon.top/"
    }
  ]
}</script><link rel="shortcut icon" href="/images/avatar.jpg"><link rel="canonical" href="http://sucrayon.top/posts/ca74b95d/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script async="async" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-8421850827711566',
  enable_page_level_ads: 'true'
});</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":150,"languages":{"author":"作者: 魚禾","link":"链接: ","source":"来源: Crayonの博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: true,
  isAnchor: false,
  percent: {
    toc: false,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Git权威指南',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/static/css/common.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load', preloader.endLoading)

  if (false) {
    btf.addGlobalFn('pjaxSend', preloader.initLoading, 'preloader_init')
    btf.addGlobalFn('pjaxComplete', preloader.endLoading, 'preloader_end')
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src= "/images/loading.gif" data-lazy-src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/projects/"><i class="fa-fw fas fa-code"></i><span> 项目</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/novel/"><i class="fa-fw fas fa-book-open"></i><span> 小说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 外链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/images/cover/default-cover/5.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">Crayonの博客</span></a><a class="nav-page-title" href="/"><span class="site-name">Git权威指南</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/projects/"><i class="fa-fw fas fa-code"></i><span> 项目</span></a></div><div class="menus_item"><span class="site-page group hide"><i class="fa-fw fas fa-heartbeat"></i><span> 娱乐</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/novel/"><i class="fa-fw fas fa-book-open"></i><span> 小说</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 外链</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Git权威指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-15T16:00:00.000Z" title="发表于 2022-05-16 00:00:00">2022-05-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-06-14T16:00:00.000Z" title="更新于 2022-06-15 00:00:00">2022-06-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%95%83%E4%B9%A6/">啃书</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>28分钟</span></span><span class="post-meta-separator">|</span><span class="leancloud_visitors" id="/posts/ca74b95d/" data-flag-title="Git权威指南"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span class="leancloud-visitors-count"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/posts/ca74b95d/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/posts/ca74b95d/" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><html><head></head><body><h2 id="Git权威指南"><a href="#Git权威指南" class="headerlink" title="Git权威指南"></a>Git权威指南</h2><h3 id="第4章-git初始化"><a href="#第4章-git初始化" class="headerlink" title="第4章 git初始化"></a>第4章 git初始化</h3><h4 id="创建版本库及第一次提交"><a href="#创建版本库及第一次提交" class="headerlink" title="创建版本库及第一次提交"></a>创建版本库及第一次提交</h4><ol>
<li><p>告诉Git当前用户的姓名和邮件地址，配置的用户名和邮件地址将在版本库提交时用到</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">"[用户名]"</span></span><br><span class="line">git config --global user.email <span class="string">"[邮件地址]"</span></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>初始化仓库</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> demo</span><br><span class="line"><span class="built_in">cd</span> demo</span><br><span class="line">git init</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> D:/workspace/git/demo/.git/</span><br></pre></td></tr></tbody></table></figure>

<p>如果Git版本是1.6.5以上，可以在<code>git init</code>命令后面跟上目录名称，会自动完成目录创建</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git init demo</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> D:/workspace/git/demo/.git/</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<p>至此仓库即创建成功</p>
<p>现在在工作区中创建一个文件welcome.txt</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"Hello."</span> &gt; welcome.txt</span><br></pre></td></tr></tbody></table></figure>

<p>将新建立的文件添加到版本库</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add welcome.txt</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>  Git和大部分其他版本控制系统一样，都需要执行一次提交操作，对于Git来说就是执行<code>git commit</code>命令。</p>
<p>  在提交过程中需要输入提交说明，这个要求对Git来说是强制性的（不接受空白提交说明），就算在提交时不在命令行提供，Git会自动打开一个编辑器要求输入提交说明的。</p>
</blockquote>
<p>使用<code>-m</code>参数直接给出提交说明</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">"initialized."</span></span><br><span class="line">[master (root-commit) dbda1b1] initialized.</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 welcome.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li>通过<code>-m</code>参数设置提交说明</li>
<li>命令输出显示此次提交在名为master的分支上，且是该分支的第一次提交（root-commit），提交ID是dbda1b1。</li>
<li>此次提交修改了一个文件，包含一行插入（新增）</li>
<li>此次提交创建了新文件welcome.txt</li>
</ul>
<p>如果之前没有设置用户名和邮箱，则会出现如下内容：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Author identity unknown</span><br><span class="line"></span><br><span class="line">*** Please tell me <span class="built_in">who</span> you are.</span><br><span class="line"></span><br><span class="line">Run</span><br><span class="line"></span><br><span class="line">  git config --global user.email <span class="string">"you@example.com"</span></span><br><span class="line">  git config --global user.name <span class="string">"Your Name"</span></span><br><span class="line"></span><br><span class="line">to <span class="built_in">set</span> your account<span class="string">'s default identity.</span></span><br><span class="line"><span class="string">Omit --global to set the identity only in this repository.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fatal: unable to auto-detect email address (got '</span>User@8-sri0091.(none)<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="思考：为什么工作区根目录有一个-git目录"><a href="#思考：为什么工作区根目录有一个-git目录" class="headerlink" title="思考：为什么工作区根目录有一个.git目录"></a>思考：为什么工作区根目录有一个.git目录</h4><p>初始化仓库之后，会在根目录出现名为<code>.git</code>的隐藏目录</p>
<p>Windows用户需要通过如下方式设置后才可以看到</p>
<p><img src= "/images/loading.gif" data-lazy-src="/images/posts-assets/Git%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97.assets/20220516153036140.jpg" alt="20220516153036140"></p>
<p>Linux用户通过以下命令可查看</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -a</span><br><span class="line">./  ../  .git/</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>Git以及其他分布式版本控制系统的一个共同的显著特点是，版本库位于工作区的根目录下。对Git来说就是<code>.git</code>目录，且仅此一处，没有任何其他跟踪文件或目录了。</p>
<p>传统集中式版本控制系统的版本库和工作区是分开的，甚至是在不同的主机上，因此必须建立工作区和版本库的对应。</p>
<p>Git将版本库（<code>.git</code>目录）放在工作区根目录下，那么Git的相关操作一定要在工作区根目录下执行吗？换句话说，当工作区中包含子目录，并在子目录中执行Git命令，如何定位到版本库的？</p>
<p>实际上，当在Git工作区的某个子目录下执行操作的时候，会在工作区目录中依次向上递归查找<code>.git</code>目录，找到的<code>.git</code>目录就是工作区对应的版本库了。</p>
<p>例如在非Git工作区执行<code>git</code>命令时会因为找不到<code>.git</code>目录报错</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /d/workspace/git</span><br><span class="line">git status</span><br><span class="line">fatal: not a git repository (or any of the parent directories): .git</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>使用<code>strace</code>命令去跟踪执行<code>git status</code>命令时的磁盘访问，可以看到沿目录依次向上递归的过程。</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strace -e <span class="string">'trace=file'</span> git status</span><br></pre></td></tr></tbody></table></figure>



<p>显示版本库<code>.git</code>目录所在位置</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rev-parse --git-dir</span><br><span class="line">D:/workspace/git/demo/.git</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>显示工作区根目录</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rev-parse --show-toplevel</span><br><span class="line">D:/workspace/git/demo</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>相对于工作区根目录的相对目录</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rev-parse --show-prefix</span><br><span class="line">a/b/c/</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>显示从当前目录后退到工作区根目录的深度</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git rev-parse --show-cdup</span><br><span class="line">../../../</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h4 id="思考：git-config命令的各参数区别"><a href="#思考：git-config命令的各参数区别" class="headerlink" title="思考：git config命令的各参数区别"></a>思考：git config命令的各参数区别</h4><p>Git的配置文件分别是版本库级别、全局（用户主目录下，用户级）和系统级别。</p>
<p><code>--global</code>：全局级别</p>
<p><code>--system</code>：系统级别</p>
<h3 id="第5章-git暂存区"><a href="#第5章-git暂存区" class="headerlink" title="第5章 git暂存区"></a>第5章 git暂存区</h3><h4 id="修改不能直接提交吗"><a href="#修改不能直接提交吗" class="headerlink" title="修改不能直接提交吗"></a>修改不能直接提交吗</h4><p>首先进行文件追加</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"Nice to meet you."</span> &gt;&gt; welcome.txt</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br><span class="line">diff --git a/welcome.txt b/welcome.txt</span><br><span class="line">index 18832d3..fd3c069 100644</span><br><span class="line">--- a/welcome.txt</span><br><span class="line">+++ b/welcome.txt</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> Hello.</span><br><span class="line">+Nice to meet you.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>需要执行<code>git add</code>命令将文件修改添加到暂存区之后才可以进行提交</p>
<p>如果直接执行提交操作</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git commit -m <span class="string">"Append a nice line."</span></span><br><span class="line">On branch master</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">        modified:   welcome.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use <span class="string">"git add"</span> and/or <span class="string">"git commit -a"</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<h4 id="理解Git暂存区（stage）"><a href="#理解Git暂存区（stage）" class="headerlink" title="理解Git暂存区（stage）"></a>理解Git暂存区（stage）</h4><p>在版本库<code>.git</code>目录下有一个index文件，下面针对这个文件做一个实验</p>
<ol>
<li><p>撤销工作区中对welcome.txt文件尚未提交的更改</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout -- welcome.txt <span class="comment"># 撤销工作区中对welcome.txt文件尚未提交的更改</span></span><br><span class="line">git status -s <span class="comment"># 如果git版本小于1.7.3，执行git diff</span></span><br></pre></td></tr></tbody></table></figure>


</li>
<li><p>查看.git/index文件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> --full-time .git/index</span><br><span class="line">-rw-r--r-- 1 User 197121 145 2022-05-16 19:17:16.292820100 +0800 .git/index</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>再次执行</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git status -s <span class="comment"># 再次执行</span></span><br><span class="line"><span class="built_in">ls</span> --full-time .git/index</span><br><span class="line">-rw-r--r-- 1 User 197121 145 2022-05-16 19:17:16.292820100 +0800 .git/index</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>可以看到时间戳不变</p>
</li>
<li><p>现在修改下welcome.txt的时间戳，但是不改变它的内容</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> --full-time welcome.txt</span><br><span class="line">-rw-r--r-- 1 User 197121 25 2022-05-16 19:18:32.223701400 +0800 welcome.txt</span><br><span class="line"><span class="built_in">touch</span> welcome.txt</span><br><span class="line"><span class="built_in">ls</span> --full-time welcome.txt <span class="comment"># 可以看到时间戳更新了</span></span><br><span class="line">-rw-r--r-- 1 User 197121 25 2022-05-16 19:24:35.298879700 +0800 welcome.txt</span><br><span class="line">git status -s</span><br><span class="line"><span class="built_in">ls</span> --full-time .git/index <span class="comment"># 时间戳更新了</span></span><br><span class="line">-rw-r--r-- 1 User 197121 145 2022-05-16 19:25:20.322562900 +0800 .git/index</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<p>实验说明<code>git status</code>命令是先根据.git/index文件中记录的（用于跟踪工作区文件的）时间戳、长度等信息判断工作区文件是否改变，如果工作区文件的时间戳改变了，说明文件的内容可能被改变了，需要打开文件，读取文件内容进行比较。如果文件内容没变，则将该文件的新时间戳记录到.git/index文件中。因为如果要判断文件是否更改，使用时间戳、文件长度等信息进行比较要比通过文件内容比较要快得多，这也是Git高效的原因之一。</p>
<p>文件.git/index实际就是一个包含文件索引的目录数，记录了文件名和文件的状态信息（时间戳和文件长度等）。文件内容保存在.git/objects目录中</p>
<p><img src= "/images/loading.gif" data-lazy-src="/images/posts-assets/Git%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97.assets/20220516193323223.jpg" alt="20220516193323223"></p>
<ul>
<li>左侧为工作区，右侧为版本库。在版本库中标记为index的区域是暂存区，标记为master的是master分支所代表的目录树。</li>
<li>此时HEAD实际是指向master分支的一个“游标”，所以图示的命令中出现HEAD的地方可以用master替换。</li>
<li>图中的objects为Git对象库，实际位于.git/objects目录下。</li>
<li>当对工作区修改（或新增）的文件执行<code>git add</code>命令时，暂存区的目录树将被更新，同时工作区修改（或新增）的文件内容会被写入对象库中的一个新的对象中，而该对象的ID被记录在暂存区的文件索引中。</li>
<li>当执行<code>git commit</code>时，暂存区的目录树会写到版本库（对象库）中，master分支会做相应的更新，即master最新指向的目录树就是提交时原暂存区的目录树。</li>
<li>当执行<code>git reset HEAD</code>命令时，暂存区的目录树会被重写，会被master分支指向的目录树所替换，但是工作区不受影响。</li>
<li>当执行<code>git rm --cached &lt;file&gt;</code>命令时，会直接从暂存区删除文件，工作区不做出改变。</li>
<li>当执行<code>git checkout .</code>或<code>git checkout -- &lt;file&gt;</code>命令时，会用暂存区全部文件或指定文件替换工作区文件。这个操作很危险，会清除工作区中未添加到暂存区的改动。</li>
<li>当执行<code>git checkout HEAD .</code>或<code>git checkout HEAD &lt;file&gt;</code>命令时，会用HEAD指向的master分支中的全部或部分文件替换暂存区和工作区中的文件。这个命令极其危险，因为不但会清楚工作区中未提交的改动，也会清除暂存区中未提交的改动。</li>
</ul>
<p>栗子：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> new.txt <span class="comment"># 创建新文件</span></span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line">        new.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br><span class="line"></span><br><span class="line">git add new.txt <span class="comment"># 添加到暂存区</span></span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span><br><span class="line">        new file:   new.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"new line."</span> &gt;&gt; new.txt <span class="comment"># 更新文件</span></span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span><br><span class="line">        new file:   new.txt</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">        modified:   new.txt</span><br><span class="line"><span class="comment"># 此时工作区中有更改未提交（新增数据的更改）到暂存区，暂存区也有更改未提交（新增文件）到版本库</span></span><br><span class="line">git checkout -- new.txt</span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span><br><span class="line">        new file:   new.txt</span><br><span class="line"><span class="comment"># 此时工作区中未提交的修改已经被清除了</span></span><br><span class="line"><span class="built_in">cat</span> new.txt</span><br><span class="line"><span class="comment"># 查看new.txt的内容，没有发现新增的数据</span></span><br><span class="line"><span class="comment"># 重新将文件更改，这里就省略了</span></span><br><span class="line">git reset HEAD</span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line">        new.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br><span class="line"><span class="comment"># 可以看到暂存区未提交的更改被清除，new.txt变成了未追踪状态了</span></span><br><span class="line"><span class="comment"># 工作区中的内容不受影响</span></span><br><span class="line"><span class="built_in">cat</span> new.txt</span><br><span class="line">new line.</span><br><span class="line"><span class="comment"># 重新恢复下状态，这里省略了</span></span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span><br><span class="line">        new file:   new.txt</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">        modified:   new.txt</span><br><span class="line"></span><br><span class="line">git <span class="built_in">rm</span> --cached new.txt</span><br><span class="line">error: the following file has staged content different from both the</span><br><span class="line">file and the HEAD:</span><br><span class="line">    new.txt</span><br><span class="line">(use -f to force removal)</span><br><span class="line"><span class="comment"># 此时三个区域的状态均不同，所以不允许此操作，可以使用-f参数强制执行</span></span><br><span class="line">git <span class="built_in">rm</span> --cached -f new.txt</span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Untracked files:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to include <span class="keyword">in</span> what will be committed)</span><br><span class="line">        new.txt</span><br><span class="line"></span><br><span class="line">nothing added to commit but untracked files present (use <span class="string">"git add"</span> to track)</span><br><span class="line"><span class="comment"># 此时暂存区中文件被删除了，所以new.txt变成了未追踪状态，工作区中文件不变</span></span><br><span class="line"><span class="comment"># 恢复下状态，这里省略了</span></span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span><br><span class="line">        new file:   new.txt</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">        modified:   new.txt</span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">"add new.txt"</span> <span class="comment"># 将新增的new.txt提交到版本库</span></span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">        modified:   new.txt</span><br><span class="line"><span class="comment"># new.txt新增数据的更新还在工作区中</span></span><br><span class="line">git add new.txt</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"new new line."</span> &gt;&gt; new.txt</span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span><br><span class="line">        modified:   new.txt</span><br><span class="line"></span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">        modified:   new.txt</span><br><span class="line"></span><br><span class="line"> git checkout master new.txt <span class="comment"># 此操作将清空工作区和暂存区的更改</span></span><br><span class="line"> git status</span><br><span class="line"> On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line"><span class="built_in">cat</span> new.txt</span><br><span class="line"><span class="comment"># 最终new.txt中没有内容，被替换成了版本库中的版本了</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="git-diff"><a href="#git-diff" class="headerlink" title="git diff"></a>git diff</h4><p><strong>工作区、暂存区和版本库的目录树浏览</strong></p>
<p>直观地查看暂存区及HEAD中的目录树？</p>
<p>对于HEAD（版本库中当前提交）指向的目录树，可以使用Git底层命令<code>ls-tree</code>查看</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git ls-tree -l HEAD</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391       0    new.txt</span><br><span class="line">100644 blob fd3c069c1de4f4bc9b15940f490aeb48852f3c42      25    welcome.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<ul>
<li><code>-l</code>参数可以显示文件的大小</li>
</ul>
<p><code>git ls-files</code>命令可以显示暂存区目录树</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git ls-files -s</span><br><span class="line">100644 e69de29bb2d1d6434b8b29ae775ad8c2e48c5391 0       new.txt</span><br><span class="line">100644 9ac7e0760066ad8d06a0d952c4e1260e628551b4 0       welcome.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>第三列不是文件大小，而是文件编号</p>
<p><strong>git diff</strong></p>
<ol>
<li><p>工作区与暂存区比较</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git diff</span><br><span class="line">diff --git a/new.txt b/new.txt</span><br><span class="line">index e69de29..2595e07 100644</span><br><span class="line">--- a/new.txt</span><br><span class="line">+++ b/new.txt</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+new line.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>暂存区和HEAD比较</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git diff --cached</span><br><span class="line">index fd3c069..9ac7e07 100644</span><br><span class="line">--- a/welcome.txt</span><br><span class="line">+++ b/welcome.txt</span><br><span class="line">@@ -1,2 +1,3 @@</span><br><span class="line"> Hello.</span><br><span class="line"> Nice to meet you.</span><br><span class="line">+Bye <span class="built_in">bye</span>.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>工作区和HEAD比较</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">git diff HEAD</span><br><span class="line">diff --git a/new.txt b/new.txt</span><br><span class="line">index e69de29..2595e07 100644</span><br><span class="line">--- a/new.txt</span><br><span class="line">+++ b/new.txt</span><br><span class="line">@@ -0,0 +1 @@</span><br><span class="line">+new line.</span><br><span class="line">diff --git a/welcome.txt b/welcome.txt</span><br><span class="line">index fd3c069..9ac7e07 100644</span><br><span class="line">--- a/welcome.txt</span><br><span class="line">+++ b/welcome.txt</span><br><span class="line">@@ -1,2 +1,3 @@</span><br><span class="line"> Hello.</span><br><span class="line"> Nice to meet you.</span><br><span class="line">+Bye <span class="built_in">bye</span>.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></li>
</ol>
<h3 id="第6章-git对象"><a href="#第6章-git对象" class="headerlink" title="第6章 git对象"></a>第6章 git对象</h3><h4 id="Git对象库"><a href="#Git对象库" class="headerlink" title="Git对象库"></a>Git对象库</h4><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> -1 --pretty=raw</span><br><span class="line">commit 86343253f0d44b3a002b11423c02587fd3040e07 <span class="comment"># 这些数字实际上是SHA1哈希值，这是本次提交的唯一标识</span></span><br><span class="line">tree f341012ebeaf74262be6892be96ecce373a68ef3 <span class="comment"># 这是本次提交所对应的目录树</span></span><br><span class="line">parent ca04d27bdf1a442d67c379fd5803f5b85c868bd5 <span class="comment"># 这是本次提交的父提交（上一次提交）</span></span><br><span class="line">author Crayon &lt;614820984@qq.com&gt; 1652703487 +0800</span><br><span class="line">committer Crayon &lt;614820984@qq.com&gt; 1652703487 +0800</span><br><span class="line"></span><br><span class="line">    add new.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>研究Git对象ID可以使用<code>git cat-file</code>命令</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git cat-file -t &lt;ID&gt; <span class="comment"># 查看ID类型</span></span><br><span class="line">git cat-file -p &lt;ID&gt; <span class="comment"># 查看文件内容</span></span><br></pre></td></tr></tbody></table></figure>

<h4 id="SHA1哈希值是什么"><a href="#SHA1哈希值是什么" class="headerlink" title="SHA1哈希值是什么"></a>SHA1哈希值是什么</h4><p>哈希是一种摘要算法（散列算法），可以将任意长度的输入经过散列运算转换为固定长度的输出。</p>
<p>比较著名的摘要算法有MD5和SHA1</p>
<p>Linux下使用<code>sha1sum</code>命令可以生成摘要</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span> Git | <span class="built_in">sha1sum</span></span><br><span class="line">5819778898df55e3a762f0c5728b457970d72cae *-</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>提交的SHA1哈希值是如何生成的</p>
<ul>
<li><p>查看HEAD对应的提交内容</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git cat-file commit HEAD</span><br><span class="line">tree f341012ebeaf74262be6892be96ecce373a68ef3</span><br><span class="line">parent ca04d27bdf1a442d67c379fd5803f5b85c868bd5</span><br><span class="line">author Crayon &lt;614820984@qq.com&gt; 1652703487 +0800</span><br><span class="line">committer Crayon &lt;614820984@qq.com&gt; 1652703487 +0800</span><br><span class="line"></span><br><span class="line">add new.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>提交信息中总共包含个210字符</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git cat-file commit HEAD | <span class="built_in">wc</span> -c</span><br><span class="line">210</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>在提交信息的前面加上内容commit 210&lt;null&gt;（&lt;null&gt;为空字符），然后执行SHA1算法</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">printf</span> <span class="string">"commit 210\000"</span>; git cat-file commit HEAD) | <span class="built_in">sha1sum</span></span><br><span class="line">86343253f0d44b3a002b11423c02587fd3040e07 *-</span><br><span class="line"></span><br><span class="line">git rev-parse HEAD</span><br><span class="line">86343253f0d44b3a002b11423c02587fd3040e07</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<p>文件内容的SHA1哈希值是如何生成的</p>
<ul>
<li><p>查看版本库中welcome.txt的内容</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git cat-file blob HEAD:welcome.txt</span><br><span class="line">Hello.</span><br><span class="line">Nice to meet you.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>文件总共包含25字节的内容</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git cat-file blob HEAD:welcome.txt | <span class="built_in">wc</span> -c</span><br><span class="line">25</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>在文件内容的前面加上blob 25&lt;null&gt;，然后执行SHA1算法</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="built_in">printf</span> <span class="string">"blob 25\000"</span>; git cat-file blob HEAD:welcome.txt) | <span class="built_in">sha1sum</span></span><br><span class="line">fd3c069c1de4f4bc9b15940f490aeb48852f3c42 *-</span><br><span class="line">git rev-parse HEAD:welcome.txt</span><br><span class="line">fd3c069c1de4f4bc9b15940f490aeb48852f3c42</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<blockquote>
<p>  HEAD代表版本库中最近一次提交</p>
<p>  符号<code>^</code>可以用于指代父提交。例如：</p>
<ul>
<li><code>HEAD^</code>代表版本库中的上一次提交，即最近一次提交的父提交</li>
<li><code>HEAD^^</code>则代表<code>HEAD^</code>的父提交</li>
</ul>
<p>  对于一个提交有很多个父提交，可以在符号<code>^</code>后面用数字表示第几次提交。例如：</p>
<ul>
<li><code>a573106^2</code>的含义是提交<code>a573106</code>的多个父提交中的第二个父提交（日志分支图体现在横向）（不是祖先提交！）<a href="#8.2.multi-parent">例子</a></li>
<li><code>HEAD^1</code>相当于<code>HEAD^</code></li>
</ul>
<p>  符号<code>~&lt;n&gt;</code>也可以用于指代祖先提交（日志分支图体现在纵向）。例如：</p>
<p>  <code>a573106~5</code>相当于<code>a573106^^^^^</code></p>
</blockquote>
<h3 id="第7章-git重置"><a href="#第7章-git重置" class="headerlink" title="第7章 git重置"></a>第7章 git重置</h3><p>master分支在版本库的引用目录（.git/refs）中体现为一个引用文件<code>.git/refs/heads/master</code>，其内容就是分支中最新提交的提交ID</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> .git/refs/heads/master</span><br><span class="line">86343253f0d44b3a002b11423c02587fd3040e07</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>



<p>添加新文件，查看ID</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> new-commit.txt</span><br><span class="line">git add new-commit.txt</span><br><span class="line"><span class="built_in">cat</span> .git/refs/heads/master</span><br><span class="line">724d3845eb776ded300fedf37e8642b81c6f8b54</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>引用<code>refs/heads/master</code>就像一个游标，在有新的提交的时候指向了新的提交</p>
<p><code>git reset</code>命令可以将“游标”指向任意一个存在的提交ID</p>
<p>重置之后如果没有记住提交ID，通过浏览历史记录是找不到的</p>
<h4 id="用reflog挽救错误的重置"><a href="#用reflog挽救错误的重置" class="headerlink" title="用reflog挽救错误的重置"></a>用reflog挽救错误的重置</h4><p>如果没有重置前master分支指向的提交ID，想要重置回原来的提交似乎是一件麻烦的事（去对象库中一个一个地找）。</p>
<p><code>.git/logs</code>目录下日志文件记录了分支变更情况。默认非裸版本库（带有工作区）都提供分支日志功能，这是因为带有工作区的版本库都有如下设置：</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git config core.logallrefupdates</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>查看master分支的日志文件<code>.git/logs/refs/heads/master</code>中的内容</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">tail</span> -5 .git/logs/refs/heads/master</span><br><span class="line">86343253f0d44b3a002b11423c02587fd3040e07 33d9b1023f6be2ae49454973d071be2b28e1facb Crayon &lt;614820984@qq.com&gt; 1652790561 +0800    commit: new commit</span><br><span class="line">33d9b1023f6be2ae49454973d071be2b28e1facb 86343253f0d44b3a002b11423c02587fd3040e07 Crayon &lt;614820984@qq.com&gt; 1652790577 +0800    reset: moving to HEAD~1</span><br><span class="line">86343253f0d44b3a002b11423c02587fd3040e07 724d3845eb776ded300fedf37e8642b81c6f8b54 Crayon &lt;614820984@qq.com&gt; 1652790678 +0800    reset: moving to 724d3845eb776ded300fedf37e8642b81c6f8b54</span><br><span class="line">724d3845eb776ded300fedf37e8642b81c6f8b54 86343253f0d44b3a002b11423c02587fd3040e07 Crayon &lt;614820984@qq.com&gt; 1652790709 +0800    reset: moving to HEAD~1</span><br><span class="line">86343253f0d44b3a002b11423c02587fd3040e07 724d3845eb776ded300fedf37e8642b81c6f8b54 Crayon &lt;614820984@qq.com&gt; 1652790722 +0800    reset: moving to 724d3845eb776ded300fedf37e8642b81c6f8b54</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>第一列表示原指向，第二列表示变更后指向，文件最后是最新的记录</p>
<p>Git提供<code>git reflog</code>命令</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git reflog show master | <span class="built_in">head</span> -5 <span class="comment"># head -5表示取前五行</span></span><br><span class="line">724d384 HEAD@{0}: reset: moving to 724d3845eb776ded300fedf37e8642b81c6f8b54</span><br><span class="line">8634325 HEAD@{1}: reset: moving to HEAD~1</span><br><span class="line">724d384 HEAD@{2}: reset: moving to 724d3845eb776ded300fedf37e8642b81c6f8b54</span><br><span class="line">8634325 HEAD@{3}: reset: moving to HEAD~1</span><br><span class="line">33d9b10 HEAD@{4}: commit: new commit</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>与日志文件不同，这里输出的第一行即为最新版本</p>
<p><code>git reflog</code>命令在输出中提供了一个方便易记的表达式：&lt;refname&gt;@{&lt;n&gt;}</p>
<p>这个表达式的含义是引用&lt;refname&gt;之前第&lt;n&gt;次改变时的SHA1哈希值</p>
<ul>
<li><p>重置master为两次改变之前的值</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard master@{2}</span><br></pre></td></tr></tbody></table></figure>

<p>重置后就能成功回到被撤销的版本了</p>
</li>
</ul>
<h4 id="深入了解git-reset命令"><a href="#深入了解git-reset命令" class="headerlink" title="深入了解git reset命令"></a>深入了解<code>git reset</code>命令</h4><p><code>git reset</code>命令有两种用法</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset [-q] [&lt;commit&gt;] [--] &lt;paths&gt;...</span><br><span class="line">$ git reset [--soft | --mixed | --hard | --merge | --keep] [-q] [&lt;commit&gt;]</span><br></pre></td></tr></tbody></table></figure>

<p><span id="7.2.reset-default">上述两种用法中，其中&lt;commit&gt;都是可选项，可以使用引用或提交ID，如果省略&lt;commit&gt;则相当于使用HEAD的指向作为提交ID。</span></p>
<p>第一种用法在命令中包含路径&lt;paths&gt;，为了避免和提交ID同名而发生冲突，可以在&lt;paths&gt;前用两个连续的<code>-</code>作为分隔。</p>
<blockquote>
<p>  第一种用法不会重置引用，更不会改变工作区，而是用指定的提交状态下的文件替换掉暂存区中的文件。</p>
<p>  例子：</p>
  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先往new.txt添加新内容</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"new line."</span> &gt;&gt; new.txt</span><br><span class="line">git add new.txt</span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span><br><span class="line">        modified:   new.txt</span><br><span class="line"></span><br><span class="line">git reset -- new.txt</span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M       new.txt</span><br><span class="line"></span><br><span class="line">git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged <span class="keyword">for</span> commit:</span><br><span class="line">  (use <span class="string">"git add &lt;file&gt;..."</span> to update what will be committed)</span><br><span class="line">  (use <span class="string">"git restore &lt;file&gt;..."</span> to discard changes <span class="keyword">in</span> working directory)</span><br><span class="line">        modified:   new.txt</span><br><span class="line"><span class="comment"># 可以看到刚刚的提交被撤销了</span></span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p>第二种用法则会重置引用，而且根据参数的不同可以对工作区或暂存区进行重置</p>
<p><img src= "/images/loading.gif" data-lazy-src="/images/posts-assets/Git%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97.assets/20220518160543182.jpg" alt="20220518160543182"></p>
<p>命令格式：<code>git reset [--soft | --mixed | --hard] [&lt;commit&gt;]</code></p>
<ul>
<li><code>--hard</code>参数：会执行上图中的全部动作①、②、③，即：<ol>
<li>替换引用的指向。引用指向新的提交ID。</li>
<li>替换暂存区。替换后，暂存区的内容和引用指向的目录树一致。</li>
<li>替换工作区。替换后，工作区的内容变得和暂存区一致，也和HEAD所指向的目录树一致。</li>
</ol>
</li>
<li><code>--soft</code>参数：会执行动作①。即只更改引用的指向，不改变暂存区和工作区。</li>
<li><code>--mixed</code>参数或不加参数（默认<code>--mixed</code>）：会执行动作①、②。即更改引用的指向并重置暂存区，但是不改变工作区。</li>
</ul>
<p>例子：</p>
<ul>
<li><p><code>git reset</code>（同<code>git reset HEAD</code>）</p>
<p>用HEAD指向的目录树重置暂存区，工作区不会受到影响。</p>
<blockquote>
<p>  相当于将之前用<code>git add</code>命令添加到暂存区的内容撤出</p>
</blockquote>
</li>
<li><p><code>git reset --soft HEAD^</code></p>
<p>工作区和暂存区不做改变，但是引用回退一次。当对最新提交的提交说明或提交更改不满意的时候，撤销最新的提交以便重新提交。</p>
<blockquote>
<p>  <code>git commit --amend</code>用于对最新的提交进行重新提交以修补错误的提交说明或提交文件。</p>
<p>  相当于执行了下面两条命令</p>
  <figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git reset --soft HEAD^</span><br><span class="line">git commit -e -F .git/COMMIT_EDITMSG <span class="comment"># .git/COMMIT_EDITMSG保存了上次的提交日志</span></span><br></pre></td></tr></tbody></table></figure>
</blockquote>
</li>
<li><p><code>git reset HEAD^</code>同（<code>git reset --mixed HEAD^</code>）</p>
<p>工作区不变，将暂存区和引用回退一次</p>
</li>
<li><p><code>git reset --hard HEAD^</code></p>
<p>彻底撤销最近的提交。工作区、暂存区、引用全部回退。</p>
</li>
</ul>
<h3 id="第8章-git检出"><a href="#第8章-git检出" class="headerlink" title="第8章 git检出"></a>第8章 git检出</h3><p>重置命令的一个用途就是修改引用的游标指向。</p>
<p><del>重置命令没有使用任何参数对所要重置的分支名进行设置，这是因为重置命令针对的是头指针<code>HEAD</code>。</del></p>
<p>重置命令没有改变头指针<code>HEAD</code>的内容是因为HEAD指向了一个引用<code>rerf/heads/master</code>，所以重置命令体现为分支“游标”的变更，<code>HEAD</code>本身一直指向的是<code>refs/heads/master</code>，并没有在重置时改变。</p>
<h4 id="HEAD的重置即检出"><a href="#HEAD的重置即检出" class="headerlink" title="HEAD的重置即检出"></a>HEAD的重置即检出</h4><p><code>HEAD</code>可以理解为“头指针”，是当前工作区的“基础版本”，当执行提交时，将指向最新的提交</p>
<p>查看当前<code>HEAD</code>的指向</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> .git/HEAD</span><br><span class="line">ref: refs/heads/master</span><br><span class="line">$ git branch -v</span><br><span class="line">* master 8634325 add new.txt</span><br></pre></td></tr></tbody></table></figure>

<p>用<code>git checkout</code>命令检出该ID的父提交</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout 8634325^</span><br><span class="line">Note: switching to <span class="string">'8634325^'</span>.</span><br><span class="line"></span><br><span class="line">You are <span class="keyword">in</span> <span class="string">'detached HEAD'</span> state. You can look around, make experimental</span><br><span class="line">changes and commit them, and you can discard any commits you make <span class="keyword">in</span> this</span><br><span class="line">state without impacting any branches by switching back to a branch.</span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line"><span class="keyword">do</span> so (now or later) by using -c with the switch <span class="built_in">command</span>. Example:</span><br><span class="line"></span><br><span class="line">  git switch -c &lt;new-branch-name&gt;</span><br><span class="line"></span><br><span class="line">Or undo this operation with:</span><br><span class="line"></span><br><span class="line">  git switch -</span><br><span class="line"></span><br><span class="line">Turn off this advice by setting config variable advice.detachedHead to <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">HEAD is now at ca04d27 Append a <span class="built_in">nice</span> line.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>出现大段的输出，意思就是现在处于“分离头指针”的状态，在这个状态下执行另一个<code>checkout</code>命令检出则会丢弃在此状态下的修改和提交，如果想要保留此状态下的修改和提交，使用<code>-b</code>参数调用<code>checkout</code>命令来创建新的跟踪分支，如：</p>
<p><code>git checkout -b new_branch_name</code></p>
<p>查看<code>HEAD</code>的内容可以发现头指针指向了一个具体的提交</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> .git/HEAD</span><br><span class="line">ca04d27bdf1a442d67c379fd5803f5b85c868bd5</span><br></pre></td></tr></tbody></table></figure>

<p>使用<code>reflog</code>命令也可以看到头指针被更改了</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog -1</span><br><span class="line">ca04d27 (HEAD) HEAD@{0}: checkout: moving from master to 8634325^</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>  <code>reflog</code>的内容是<code>HEAD</code>头指针的变迁记录，而不是<code>master</code>分支</p>
</blockquote>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git rev-parse HEAD master</span><br><span class="line">ca04d27bdf1a442d67c379fd5803f5b85c868bd5</span><br><span class="line">86343253f0d44b3a002b11423c02587fd3040e07</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到<code>HEAD</code>和<code>master</code>指向不同的提交</p>
<p><code>checkout</code>和<code>reset</code>命令不同，分支（<code>master</code>）的指向没有改变，还是指向的原有提交的ID</p>
<p>试着做一次更改，并加入到暂存区</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">touch</span> detached-commit.txt</span><br><span class="line">$ git add detached-commit.txt</span><br><span class="line">$ git status</span><br><span class="line">HEAD detached at ca04d27</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span><br><span class="line">        new file:   detached-commit.txt</span><br></pre></td></tr></tbody></table></figure>

<p>执行提交并查看头指针指向</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$  git commit -m <span class="string">"commit in detached HEAD mode"</span></span><br><span class="line">[detached HEAD ccedb9c] commit <span class="keyword">in</span> detached HEAD mode</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 detached-commit.txt</span><br><span class="line"> </span><br><span class="line"> $ <span class="built_in">cat</span> .git/HEAD</span><br><span class="line">ccedb9c816bd52920c9ba001c04067c935363f83</span><br></pre></td></tr></tbody></table></figure>

<p>头指针指向最新的提交</p>
<p>查看日志也可以发现新的提交建立在之前的提交基础之上</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --graph --oneline</span><br><span class="line">* ccedb9c (HEAD) commit <span class="keyword">in</span> detached HEAD mode</span><br><span class="line">* ca04d27 Append a <span class="built_in">nice</span> line.</span><br><span class="line">* 6e314b7 empty commit</span><br><span class="line">* dbda1b1 initialized.</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>  记下新的提交ID（ccedb9c）</p>
</blockquote>
<p>以<code>master</code>分支名作为参数执行<code>checkout</code>命令将分支切换到<code>master</code>上</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout master</span><br><span class="line">Warning: you are leaving 1 commit behind, not connected to</span><br><span class="line">any of your branches:</span><br><span class="line"></span><br><span class="line">  ccedb9c commit <span class="keyword">in</span> detached HEAD mode</span><br><span class="line"></span><br><span class="line">If you want to keep it by creating a new branch, this may be a good time</span><br><span class="line">to <span class="keyword">do</span> so with:</span><br><span class="line"></span><br><span class="line"> git branch &lt;new-branch-name&gt; ccedb9c</span><br><span class="line"></span><br><span class="line">Switched to branch <span class="string">'master'</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>通过日志已经看不到之前的提交了，但是仍然存在于对象库中（但是因为这个提交没有被任何分支跟踪到，所以不保证这个提交会永久存在）</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --graph --pretty=oneline</span><br><span class="line">* 86343253f0d44b3a002b11423c02587fd3040e07 (HEAD -&gt; master) add new.txt</span><br><span class="line">* ca04d27bdf1a442d67c379fd5803f5b85c868bd5 Append a <span class="built_in">nice</span> line.</span><br><span class="line">* 6e314b7f5526662dd54dc3c7e2058010557ccb5b empty commit</span><br><span class="line">* dbda1b1f8b84a477531578bd15917da5686ee8f2 initialized.</span><br></pre></td></tr></tbody></table></figure>

<h4 id="挽救分离头指针"><a href="#挽救分离头指针" class="headerlink" title="挽救分离头指针"></a>挽救分离头指针</h4><p>刚才分离头指针状态下的提交只能通过提交ID访问到，如果使用<code>reset</code>虽然可以将<code>master</code>分支重置到该提交，但是就会丢到当前<code>master</code>的最新提交（<code>reset</code>命令体现出来的就是分支游标的改变）</p>
<p>这个时候需要使用<code>merge</code>（合并）操作</p>
<p>将<code>ccedb9c</code>这个提交合并到当前分支上</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git merge ccedb9c</span><br><span class="line">Merge made by the <span class="string">'ort'</span> strategy.</span><br><span class="line"> detached-commit.txt | 0</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 detached-commit.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>查看日志可以看到不一样的分支图</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> --graph --oneline</span><br><span class="line">*   b06ad0b (HEAD -&gt; master) Merge commit <span class="string">'ccedb9c'</span></span><br><span class="line">|\</span><br><span class="line">| * ccedb9c commit <span class="keyword">in</span> detached HEAD mode</span><br><span class="line">* | 8634325 add new.txt</span><br><span class="line">|/</span><br><span class="line">* ca04d27 Append a <span class="built_in">nice</span> line.</span><br><span class="line">* 6e314b7 empty commit</span><br><span class="line">* dbda1b1 initialized.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<p>查看最新提交的信息，可以看到该提交有<span id="8.2.multi-parent">两个父提交</span></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -p HEAD</span><br><span class="line">tree d8102c804d8cbf350b31dc6a38fe384ed5586559</span><br><span class="line">parent 86343253f0d44b3a002b11423c02587fd3040e07</span><br><span class="line">parent ccedb9c816bd52920c9ba001c04067c935363f83</span><br><span class="line">author Crayon &lt;614820984@qq.com&gt; 1655277888 +0800</span><br><span class="line">committer Crayon &lt;614820984@qq.com&gt; 1655277888 +0800</span><br><span class="line"></span><br><span class="line">Merge commit <span class="string">'ccedb9c'</span></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<h4 id="深入了解git-checkout命令"><a href="#深入了解git-checkout命令" class="headerlink" title="深入了解git checkout命令"></a>深入了解<code>git checkout</code>命令</h4><p>三种用法</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout [-q] [&lt;commit&gt;] [--] &lt;paths&gt;...</span><br><span class="line">$ git checkout [&lt;branch&gt;]</span><br><span class="line">$ git checkout [-m] [[-b|--orphan] &lt;new_branch&gt;] [&lt;start_point&gt;]</span><br></pre></td></tr></tbody></table></figure>

<p>第一种用法的<code>--</code>主要是用来避免引用和路径同名发生冲突</p>
<ul>
<li><p>第一种用法的&lt;commit&gt;是可选项，如果省略则相当于从暂存区进行检出，这和<a href="#7.2.reset-default">重置命令</a>不同（重置默认值是<code>HEAD</code>）</p>
<p>重置一般用于重置暂存区（除非使用<code>--hard</code>参数，否则不重置工作区），而检出命令主要是覆盖工作区（如果&lt;commit&gt;不省略，也会替换暂存区中的相应文件）</p>
</li>
<li><p>第一种用法（包含&lt;paths&gt;的用法）不会改变<code>HEAD</code>头指针，主要用于指定版本的文件覆盖工作区中对应的文件。如果省略&lt;commit&gt;，则会用暂存区中的文件覆盖工作区的文件，否则用指定提交中的文件覆盖暂存区和工作区中对应的文件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前版本下的文件内容</span></span><br><span class="line">$ <span class="built_in">cat</span> welcome.txt</span><br><span class="line">Hello.</span><br><span class="line">Nice to meet you.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加一行，并添加到暂存区</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'new line.'</span> &gt;&gt; welcome.txt</span><br><span class="line">$ git add welcome.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次追加一行内容</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'new new line.'</span> &gt;&gt; welcome.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时的文件内容</span></span><br><span class="line">$ <span class="built_in">cat</span> welcome.txt</span><br><span class="line">Hello.</span><br><span class="line">Nice to meet you.</span><br><span class="line">new line.</span><br><span class="line">new new line.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过使用暂存区文件内容覆盖工作区文件内容实现撤销修改的目的</span></span><br><span class="line">$ git checkout -- welcome.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此时的文件内容</span></span><br><span class="line">$ <span class="built_in">cat</span> welcome.txt</span><br><span class="line">Hello.</span><br><span class="line">Nice to meet you.</span><br><span class="line">new line.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将修改提交</span></span><br><span class="line">$ git commit -m <span class="string">"append new line to welcome.txt"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 追加一行并添加到暂存区</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'new new line.'</span> &gt;&gt; welcome.txt</span><br><span class="line">$ git add welcome.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用指定版本的文件内容覆盖当前工作区与暂存区中的文件内容实现单个文件版本回退的效果</span></span><br><span class="line">$ git checkout 095d003 -- welcome.txt</span><br><span class="line"></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cat</span> welcome.txt</span><br><span class="line">Hello.</span><br><span class="line">Nice to meet you.</span><br><span class="line">new line.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以看到暂存区和工作区的内容都被清空</span></span><br><span class="line"><span class="comment"># 若是已经提交的更改的情况</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">'new new line.'</span> &gt;&gt; welcome.txt</span><br><span class="line">$ git add welcome.txt</span><br><span class="line">$ git commit -m <span class="string">"append new new line to welcome.txt"</span></span><br><span class="line">[master 7402a4e] append new new line to welcome.txt</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"></span><br><span class="line">$ git checkout 095d003 -- welcome.txt</span><br><span class="line"><span class="comment"># 工作区回退</span></span><br><span class="line">$ <span class="built_in">cat</span> welcome.txt</span><br><span class="line">Hello.</span><br><span class="line">Nice to meet you.</span><br><span class="line">new line.</span><br><span class="line"><span class="comment"># 暂存区生成新的暂存文件信息，随时可以提交修改</span></span><br><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use <span class="string">"git restore --staged &lt;file&gt;..."</span> to unstage)</span><br><span class="line">        modified:   welcome.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>第二种用法则会改变<code>HEAD</code>头指针。&lt;branch&gt;指代切换到哪个分支，如果不指定分支名则会进入“分离头指针”的状态</p>
</li>
<li><p>第三种用法主要用来创建和切换到新分支（&lt;new_branch&gt;），新的分支从&lt;start_point&gt;指定的提交开始创建</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过日志查到祖先提交的ID</span></span><br><span class="line">$ git <span class="built_in">log</span> --graph --oneline</span><br><span class="line">*   b06ad0b (HEAD -&gt; master) Merge commit <span class="string">'ccedb9c'</span></span><br><span class="line">|\</span><br><span class="line">| * ccedb9c commit <span class="keyword">in</span> detached HEAD mode</span><br><span class="line">* | 8634325 add new.txt</span><br><span class="line">|/</span><br><span class="line">* ca04d27 Append a <span class="built_in">nice</span> line.</span><br><span class="line">* 6e314b7 empty commit</span><br><span class="line">* dbda1b1 initialized.</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个从祖先提交开始的分支</span></span><br><span class="line">$ git checkout -b parent-parent ca04d27</span><br><span class="line">Switched to a new branch <span class="string">'parent-parent'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 再次查看日志可以发现分支指向祖先提交</span></span><br><span class="line">$ git <span class="built_in">log</span> --graph --oneline</span><br><span class="line">* ca04d27 (HEAD -&gt; parent-parent) Append a <span class="built_in">nice</span> line.</span><br><span class="line">* 6e314b7 empty commit</span><br><span class="line">* dbda1b1 initialized.</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>  一条特别危险的命令：</p>
<p>  <code>git checkout -- .</code>或<code>git checkout .</code></p>
<p>  <code>.</code>代表通配，也就是指所有文件</p>
<p>  它会取消所有本地修改，使用暂存区覆盖工作区</p>
</blockquote>
</li>
</ul>
<h3 id="第9章-恢复进度"><a href="#第9章-恢复进度" class="headerlink" title="第9章 恢复进度"></a>第9章 恢复进度</h3><blockquote>
<p>  <code>git stash</code>命令的使用</p>
<p>  <a target="_blank" rel="noopener" href="https://dict.youdao.com/w/stash/#keyfrom=dict2.top">stash单词释义</a></p>
</blockquote>
<p><code>git stash</code>用于保存进度与恢复进度</p>
<p>查看保存的进度</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git stash list</span><br><span class="line">stash@{0}: WIP on master: 8634325 add new.txt</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存当前工作进度，会分别对暂存区和工作区的状态进行保存</span></span><br><span class="line">$ git stash</span><br><span class="line"><span class="comment"># git stash的完整版</span></span><br><span class="line"><span class="comment"># --patch会显示工作区和HEAD的差异，通过对差异文件的编辑决定最终要保存的工作区内容</span></span><br><span class="line"><span class="comment"># -k或--keep-index会在进度保存后将暂存区重置。默认会将暂存区和工作区强制重置</span></span><br><span class="line">$ git stash [save [--patch] [-k|--[no-]keep-index] [-q|--quiet] [&lt;message&gt;]</span><br><span class="line"><span class="comment"># 显示进度列表</span></span><br><span class="line">$ git stash list</span><br><span class="line"><span class="comment"># 恢复进度</span></span><br><span class="line"><span class="comment"># 如果不使用任何参数，会恢复最新保存的进度，并将恢复的工作进度从存储的工作进度列表中清除</span></span><br><span class="line"><span class="comment"># --index会尝试恢复暂存区</span></span><br><span class="line"><span class="comment"># stash是显示进度列表时提供的stash标识，恢复指定进度</span></span><br><span class="line">$ git stash pop [--index] [&lt;stash&gt;]</span><br><span class="line"><span class="comment"># 和pop区别在于恢复后不删除进度</span></span><br><span class="line">$ git stash apply [--index] [&lt;stash&gt;]</span><br><span class="line"><span class="comment"># 删除一个进度，默认删除最新进度</span></span><br><span class="line">$ git stash drop [&lt;stash&gt;]</span><br><span class="line"><span class="comment"># 删除所有进度</span></span><br><span class="line">$ git stash clear</span><br><span class="line"><span class="comment"># 基于进度创建分支</span></span><br><span class="line">$ git stash branch &lt;branchname&gt; &lt;stash&gt;</span><br></pre></td></tr></tbody></table></figure>



<h4 id="探秘git-stash"><a href="#探秘git-stash" class="headerlink" title="探秘git stash"></a>探秘<code>git stash</code></h4></body></html></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://sucrayon.top">魚禾</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://sucrayon.top/posts/ca74b95d/">http://sucrayon.top/posts/ca74b95d/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://sucrayon.top" target="_blank">Crayonの博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Git/">Git</a></div><div class="post-share"><div class="social-share" data-image="/images/cover/default-cover/5.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wxpay.png" target="_blank"><img class="post-qr-code-img" src= "/images/loading.gif" data-lazy-src="/images/wxpay.png" alt="wxpay"/></a><div class="post-qr-code-desc">wxpay</div></li><li class="reward-item"><a href="/images/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "/images/loading.gif" data-lazy-src="/images/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/20597ff2/" title="从Paxos到Zookeeper分布式一致性原理与实践"><img class="cover" src= "/images/loading.gif" data-lazy-src="/images/cover/default-cover/1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">从Paxos到Zookeeper分布式一致性原理与实践</div></div><div class="info-2"><div class="info-item-1">从Paxos到Zookeeper分布式一致性原理与实践第1章 分布式结构从集中式到分布式集中式的特点由一台或多台主计算机组成的中心节点，数据集中存储于这个中心节点中，并且整个系统的所有业务单元都集中部署在这个中心节点上，系统的所有功能均由其集中处理。也就是说，在集中式系统中，每个终端或客户端机器仅仅负责数据的录入和输出，而数据的存储与控制处理完全交由主机完成。 特点：部署结构简单，不用考虑多节点部署带来的分布式协作问题 分布式的特点   《分布式系统概念与设计》中对分布式系统的定义：   分布式系统是一个硬件或软件组件分布在不同的网络计算机上，彼此之间仅仅通过消息传递进行通信和协调的系统。  分布式系统在没有任何特定业务逻辑约束的情况下，都会有如下几个特征：  分布性 分布式系统中的多台计算机都会在空间上随意分布，同时，机器的分布情况也会随时变动   ...</div></div></div></a><a class="pagination-related" href="/posts/b293d35b/" title="Kubernetes实战"><img class="cover" src= "/images/loading.gif" data-lazy-src="/images/cover/default-cover/10.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">Kubernetes实战</div></div><div class="info-2"><div class="info-item-1">Kubernetes实战第1部分 Kubernetes基础篇第1章 Kubernetes介绍几个概念   云计算   狭义上将是指IT基础设施的交付和使用模式，即通过网络以按需、易扩展的方式获取所需资源。   广义上则是指服务的交付和使用模式，通过网络以按需、易扩展的方式获取所需服务。   提供资源的网络被形象地比喻成“云”，其计算能力通常由分布式的大规模集群和虚拟化技术提供的。   “云”好比发电厂，互联网好比输电线路，只不过发电厂对外提供的是IT服务  业界根据云计算提供服务资源的类型将其划分为三大类：  IaaS（基础设施即服务） PaaS（平台即服务） SaaS（软件即服务）  云计算三层架构图     IaaS（基础设施即服务）   白话：卖给你硬件设备，相比与传统的设备更易扩展而已，如云硬盘、云服务器、云主机   通过虚拟化和分布式存储等技术，实现了对包括服务器、存储设备、网络设备等各种物理资源的抽象，从而形成了一个可扩展、可按需分配的虚拟资源池。目前最具代表性的IaaS产品有Amazon AWS，提供虚拟机EC2和云存储S3等服务。    ...</div></div></div></a></nav><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src= "/images/loading.gif" data-lazy-src="/images/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">魚禾</div><div class="author-info-description">Crayon</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/SuCrayon"><i class="fab fa-github"></i><span>Github</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/SuCrayon" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:614820984@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Git%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97"><span class="toc-text">Git权威指南</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-git%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">第4章 git初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%89%88%E6%9C%AC%E5%BA%93%E5%8F%8A%E7%AC%AC%E4%B8%80%E6%AC%A1%E6%8F%90%E4%BA%A4"><span class="toc-text">创建版本库及第一次提交</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%80%83%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E5%B7%A5%E4%BD%9C%E5%8C%BA%E6%A0%B9%E7%9B%AE%E5%BD%95%E6%9C%89%E4%B8%80%E4%B8%AA-git%E7%9B%AE%E5%BD%95"><span class="toc-text">思考：为什么工作区根目录有一个.git目录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%9D%E8%80%83%EF%BC%9Agit-config%E5%91%BD%E4%BB%A4%E7%9A%84%E5%90%84%E5%8F%82%E6%95%B0%E5%8C%BA%E5%88%AB"><span class="toc-text">思考：git config命令的各参数区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-git%E6%9A%82%E5%AD%98%E5%8C%BA"><span class="toc-text">第5章 git暂存区</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E4%B8%8D%E8%83%BD%E7%9B%B4%E6%8E%A5%E6%8F%90%E4%BA%A4%E5%90%97"><span class="toc-text">修改不能直接提交吗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%90%86%E8%A7%A3Git%E6%9A%82%E5%AD%98%E5%8C%BA%EF%BC%88stage%EF%BC%89"><span class="toc-text">理解Git暂存区（stage）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#git-diff"><span class="toc-text">git diff</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-git%E5%AF%B9%E8%B1%A1"><span class="toc-text">第6章 git对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Git%E5%AF%B9%E8%B1%A1%E5%BA%93"><span class="toc-text">Git对象库</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SHA1%E5%93%88%E5%B8%8C%E5%80%BC%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-text">SHA1哈希值是什么</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-git%E9%87%8D%E7%BD%AE"><span class="toc-text">第7章 git重置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8reflog%E6%8C%BD%E6%95%91%E9%94%99%E8%AF%AF%E7%9A%84%E9%87%8D%E7%BD%AE"><span class="toc-text">用reflog挽救错误的重置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3git-reset%E5%91%BD%E4%BB%A4"><span class="toc-text">深入了解git reset命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-git%E6%A3%80%E5%87%BA"><span class="toc-text">第8章 git检出</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HEAD%E7%9A%84%E9%87%8D%E7%BD%AE%E5%8D%B3%E6%A3%80%E5%87%BA"><span class="toc-text">HEAD的重置即检出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%BD%E6%95%91%E5%88%86%E7%A6%BB%E5%A4%B4%E6%8C%87%E9%92%88"><span class="toc-text">挽救分离头指针</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5%E4%BA%86%E8%A7%A3git-checkout%E5%91%BD%E4%BB%A4"><span class="toc-text">深入了解git checkout命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E6%81%A2%E5%A4%8D%E8%BF%9B%E5%BA%A6"><span class="toc-text">第9章 恢复进度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A2%E7%A7%98git-stash"><span class="toc-text">探秘git stash</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/e3e1c4a3/" title="LC-77-组合"><img src= "/images/loading.gif" data-lazy-src="/images/cover/algorithm/LC-77-%E7%BB%84%E5%90%88.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LC-77-组合"/></a><div class="content"><a class="title" href="/posts/e3e1c4a3/" title="LC-77-组合">LC-77-组合</a><time datetime="2025-02-03T08:58:00.000Z" title="更新于 2025-02-03 16:58:00">2025-02-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a381e6f7/" title="跳表-实现篇（Redis）"><img src= "/images/loading.gif" data-lazy-src="/images/cover/data-structure/skip-list/%E8%B7%B3%E8%A1%A8-%E5%AE%9E%E7%8E%B0%E7%AF%87%EF%BC%88Redis%EF%BC%89.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="跳表-实现篇（Redis）"/></a><div class="content"><a class="title" href="/posts/a381e6f7/" title="跳表-实现篇（Redis）">跳表-实现篇（Redis）</a><time datetime="2025-02-02T09:47:21.000Z" title="更新于 2025-02-02 17:47:21">2025-02-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/b1617a14/" title="跳表-实现篇（Golang）"><img src= "/images/loading.gif" data-lazy-src="/images/cover/data-structure/skip-list/%E8%B7%B3%E8%A1%A8-%E5%AE%9E%E7%8E%B0%E7%AF%87%EF%BC%88Golang%EF%BC%89.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="跳表-实现篇（Golang）"/></a><div class="content"><a class="title" href="/posts/b1617a14/" title="跳表-实现篇（Golang）">跳表-实现篇（Golang）</a><time datetime="2025-01-25T08:06:00.000Z" title="更新于 2025-01-25 16:06:00">2025-01-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2e152a56/" title="跳表-原理篇"><img src= "/images/loading.gif" data-lazy-src="/images/cover/data-structure/skip-list/%E8%B7%B3%E8%A1%A8-%E5%8E%9F%E7%90%86%E7%AF%87.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="跳表-原理篇"/></a><div class="content"><a class="title" href="/posts/2e152a56/" title="跳表-原理篇">跳表-原理篇</a><time datetime="2025-01-23T15:41:15.000Z" title="更新于 2025-01-23 23:41:15">2025-01-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a8e92d53/" title="Golang-数组与切片"><img src= "/images/loading.gif" data-lazy-src="/images/cover/programming-language/golang/%E6%95%B0%E7%BB%84%E4%B8%8E%E5%88%87%E7%89%87.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golang-数组与切片"/></a><div class="content"><a class="title" href="/posts/a8e92d53/" title="Golang-数组与切片">Golang-数组与切片</a><time datetime="2024-12-20T15:37:29.000Z" title="更新于 2024-12-20 23:37:29">2024-12-20</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/images/cover/default-cover/5.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2025 By 魚禾</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text"><div style="width:300px;margin:0 auto; padding:20px 0;"><div style="display: flex;align-items: center;justify-content: center;"><img src= "/images/loading.gif" data-lazy-src="/images/police-icon.png" style="margin-right: 4px; width: 20px; height: 20px;" /><div><a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">粤ICP备2022062775号-1</a></div></div><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=44030902003468" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">粤公网安备 44030902003468号</p></a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://unpkg.com/vanilla-lazyload@17.8.3/dist/lazyload.iife.min.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (true) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const initValine = (el, path) => {
    if (isShuoshuo) {
      window.shuoshuoComment.destroyValine = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }

    const valineConfig = {
      el: '#vcomment',
      appId: 'WkTbxHB8e44QglvhnPIwLU2n-gzGzoHsz',
      appKey: 'eXdRcA3tj4kM837wFGylIyBt',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      visitor: true,
      ...option,
      path: isShuoshuo ? path : (option && option.path) || window.location.pathname
    }

    new Valine(valineConfig)
  }

  const loadValine = async (el, path) => {
    if (typeof Valine === 'function') {
      initValine(el, path)
    } else {
      await btf.getScript('https://unpkg.com/valine@1.5.1/dist/Valine.min.js')
      initValine(el, path)
    }
  }

  if (isShuoshuo) {
    'Valine' === 'Valine'
      ? window.shuoshuoComment = { loadComment: loadValine }
      : window.loadOtherComment = loadValine
    return
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><script defer="defer" id="ribbon" src="https://unpkg.com/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"display":{"position":"left","width":150,"height":300,"hOffset":50},"mobile":{"show":false},"react":{"opacity":0.8},"log":false});</script></body></html>